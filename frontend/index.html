<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT LED Matrix Control</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>üåê IoT LED Matrix Control</h1>
            <p class="subtitle">ƒêi·ªÅu khi·ªÉn ESP8266 + MAX7219 qua MQTT</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">MQTT:</span>
                <span id="mqttStatus" class="status-value disconnected">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-label">Server:</span>
                <span id="serverStatus" class="status-value">Checking...</span>
            </div>
        </div>

        <main>
            <!-- Section 1: Database Query -->
            <section class="card query-card full-width">
                <h2>üìä Truy V·∫•n D·ªØ Li·ªáu</h2>
                <p class="subtitle">Xem th·ªëng k√™ v√† l·ªãch s·ª≠ d·ªØ li·ªáu t·ª´ c∆° s·ªü d·ªØ li·ªáu</p>

                <!-- Query Options -->
                <div class="query-options">
                    <!-- Th·ªùi gian -->
                    <div class="query-group">
                        <h3>üå°Ô∏è Nhi·ªát ƒê·ªô</h3>
                        <div class="form-group">
                            <label for="tempMinutes">S·ªë ph√∫t g·∫ßn nh·∫•t:</label>
                            <input type="number" id="tempMinutes" min="15" max="1440" value="90"
                                placeholder="Nh·∫≠p s·ªë ph√∫t">
                        </div>
                        <button id="queryTempBtn" class="btn btn-primary">Xem nhi·ªát ƒë·ªô theo ph√∫t</button>
                    </div>

                    <!-- T·ª∑ gi√° -->
                    <div class="query-group">
                        <h3>üí± T·ª∑ Gi√° Trung B√¨nh</h3>
                        <div class="form-group">
                            <label for="exchangePair">C·∫∑p ti·ªÅn:</label>
                            <select id="exchangePair">
                                <option value="USD/VND">USD ‚Üí VND</option>
                                <option value="EUR/VND">EUR ‚Üí VND</option>
                                <option value="GBP/VND">GBP ‚Üí VND</option>
                                <option value="JPY/VND">JPY ‚Üí VND</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exchangeMinutes">S·ªë ph√∫t g·∫ßn nh·∫•t:</label>
                            <input type="number" id="exchangeMinutes" min="15" max="2880" value="180"
                                placeholder="Nh·∫≠p s·ªë ph√∫t">
                        </div>
                        <button id="queryExchangeBtn" class="btn btn-primary">Xem t·ª∑ gi√° trung b√¨nh</button>
                    </div>

                    <!-- Th·ªëng k√™ t·ªïng quan -->
                    <div class="query-group">
                        <h3>üìà Th·ªëng K√™ T·ªïng Quan</h3>
                        <div class="button-group">
                            <button id="queryStatsBtn" class="btn btn-secondary">Xem th·ªëng k√™</button>
                            <button id="queryRecentBtn" class="btn btn-secondary">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</button>
                        </div>
                    </div>
                </div>

                <!-- Query Results Display -->
                <div id="queryResults" class="query-results">
                    <p class="placeholder-text">Ch·ªçn m·ªôt truy v·∫•n ƒë·ªÉ xem k·∫øt qu·∫£</p>
                </div>
            </section>

            <!-- Section 2: Weather Control -->
            <section class="card">
                <h2>üå§Ô∏è Th·ªùi Ti·∫øt</h2>
                <div class="form-group">
                    <label for="latitude">Vƒ© ƒë·ªô (Latitude):</label>
                    <input type="number" id="latitude" step="0.000001" value="10.762622" placeholder="10.762622">
                </div>
                <div class="form-group">
                    <label for="longitude">Kinh ƒë·ªô (Longitude):</label>
                    <input type="number" id="longitude" step="0.000001" value="106.660172" placeholder="106.660172">
                </div>
                <button id="updateLocationBtn" class="btn btn-primary">C·∫≠p nh·∫≠t v·ªã tr√≠</button>

                <div id="weatherDisplay" class="data-display">
                    <p class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </section>

            <!-- Section 3: Exchange Rate -->
            <section class="card">
                <h2>üí± T·ªâ Gi√°</h2>
                <div class="form-group">
                    <label for="currencyPair">Ch·ªçn c·∫∑p ti·ªÅn:</label>
                    <select id="currencyPair">
                        <option value="USD/VND">USD ‚Üí VND (ƒê√¥ la M·ªπ)</option>
                        <option value="EUR/VND">EUR ‚Üí VND (Euro)</option>
                        <option value="GBP/VND">GBP ‚Üí VND (B·∫£ng Anh)</option>
                        <option value="JPY/VND">JPY ‚Üí VND (Y√™n Nh·∫≠t)</option>
                        <option value="CNY/VND">CNY ‚Üí VND (Nh√¢n d√¢n t·ªá)</option>
                        <option value="AUD/VND">AUD ‚Üí VND (ƒê√¥ la √öc)</option>
                    </select>
                </div>
                <div class="button-group">
                    <button id="refreshExchangeBtn" class="btn btn-secondary">L√†m m·ªõi t·ª∑ gi√°</button>
                    <button id="displayExchangeBtn" class="btn btn-primary">Hi·ªÉn th·ªã l√™n LED</button>
                </div>
                <div id="exchangeDisplay" class="data-display">
                    <p class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </section>

            <!-- Section 4: Auto Display -->
            <section class="card highlight-card">
                <h2>üîÑ Ch·∫ø ƒê·ªô T·ª± ƒê·ªông</h2>
                <p class="subtitle">T·ª± ƒë·ªông hi·ªÉn th·ªã: Th·ªùi gian ‚Üí Th·ªùi ti·∫øt ‚Üí T·∫•t c·∫£ t·ª∑ gi√°</p>
                <div class="button-group">
                    <button id="autoDisplayBtn" class="btn btn-success btn-large">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu AUTO</button>
                    <button id="stopAutoBtn" class="btn btn-danger btn-large" disabled>‚èπÔ∏è D·ª´ng AUTO</button>
                </div>
                <div id="autoStatus" class="auto-status">
                    <span class="status-label">Tr·∫°ng th√°i:</span>
                    <span id="autoStatusText" class="status-value">Ch∆∞a ch·∫°y</span>
                </div>
            </section>

            <!-- Section 5: Custom Message -->
            <section class="card">
                <h2>‚úâÔ∏è Custom Message</h2>
                <div class="form-group">
                    <label for="customMessage">Nh·∫≠p message:</label>
                    <input type="text" id="customMessage" placeholder="Nh·∫≠p text ƒë·ªÉ hi·ªÉn th·ªã tr√™n LED...">
                </div>
                <div class="form-group">
                    <label for="messageMode">Ch·∫ø ƒë·ªô:</label>
                    <select id="messageMode">
                        <option value="">M·∫∑c ƒë·ªãnh</option>
                        <option value="scroll_left">Scroll Tr√°i</option>
                        <option value="scroll_right">Scroll Ph·∫£i</option>
                        <option value="blink">Blink</option>
                    </select>
                </div>
                <button id="sendMessageBtn" class="btn btn-primary">G·ª≠i Message</button>
            </section>

            <!-- Section 6: LED Settings -->
            <section class="card">
                <h2>‚öôÔ∏è C√†i ƒê·∫∑t LED</h2>

                <!-- T·ªëc ƒë·ªô cu·ªôn -->
                <div class="setting-group">
                    <h3>üèÉ T·ªëc ƒê·ªô Cu·ªôn</h3>
                    <div class="form-group">
                        <label for="ledSpeed">ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô:</label>
                        <div class="speed-control">
                            <span class="speed-label">Ch·∫≠m</span>
                            <input type="range" id="ledSpeed" min="0" max="100" value="50">
                            <span class="speed-label">Nhanh</span>
                        </div>
                        <div class="speed-display">
                            <span>Gi√° tr·ªã hi·ªán t·∫°i: <strong id="speedValue">50</strong></span>
                        </div>
                    </div>
                    <button id="applySpeedBtn" class="btn btn-primary">‚úì √Åp d·ª•ng t·ªëc ƒë·ªô</button>
                </div>

                <!-- ƒê·ªô s√°ng -->
                <div class="setting-group">
                    <h3>üí° ƒê·ªô S√°ng</h3>
                    <div class="form-group">
                        <label for="ledBrightness">ƒêi·ªÅu ch·ªânh ƒë·ªô s√°ng:</label>
                        <div class="brightness-control">
                            <span class="brightness-label">T·ªëi</span>
                            <input type="range" id="ledBrightness" min="1" max="15" value="8">
                            <span class="brightness-label">S√°ng</span>
                        </div>
                        <div class="brightness-display">
                            <span>Gi√° tr·ªã hi·ªán t·∫°i: <strong id="brightnessValue">8</strong></span>
                        </div>
                    </div>
                    <button id="applyBrightnessBtn" class="btn btn-primary">‚úì √Åp d·ª•ng ƒë·ªô s√°ng</button>
                </div>

                <!-- Ch·∫ø ƒë·ªô hi·ªÉn th·ªã -->
                <div class="setting-group">
                    <h3>üé≠ Ch·∫ø ƒê·ªô Hi·ªÉn Th·ªã</h3>
                    <div class="form-group">
                        <label for="ledMode">Ch·ªçn ch·∫ø ƒë·ªô:</label>
                        <select id="ledMode">
                            <option value="">Kh√¥ng ƒë·ªïi</option>
                            <option value="scroll_left">Scroll Tr√°i</option>
                            <option value="scroll_right">Scroll Ph·∫£i</option>
                            <option value="blink">Blink</option>
                        </select>
                    </div>
                    <button id="applyModeBtn" class="btn btn-primary">‚úì √Åp d·ª•ng ch·∫ø ƒë·ªô</button>
                </div>
            </section>
        </main>

        <footer>
            <a href="logs.html" class="btn btn-link">üìä Xem Logs</a>
        </footer>
    </div>

    <script>
        console.log("üü¢ HTML ƒë√£ load!");
        console.log("üìç Current URL:", window.location.href);
        console.log("üìç API_BASE s·∫Ω l√†: https://qiotbe.dev1.vimaru.edu.vn");
        console.log("üìç Script s·∫Ω load t·ª´:", new URL("app.js", window.location.href).href);

        // Test button click
        document.addEventListener("DOMContentLoaded", () => {
            console.log("üü° DOM Content Loaded!");
            const sendBtn = document.getElementById("sendMessageBtn");
            if (sendBtn) {
                console.log("‚úÖ Send button found!");
                sendBtn.addEventListener("click", () => {
                    console.log("üî¥ Send button clicked!");
                });
            } else {
                console.error("‚ùå Send button NOT found!");
            }
        });
    </script>
    <!-- MQTT.js library t·ª´ npm (qua CDN) - Load tr∆∞·ªõc app.js -->
    <script src="https://unpkg.com/mqtt@5.3.2/dist/mqtt.min.js"></script>
    <script src="app.js"></script>
    <script>
        window.addEventListener("error", (e) => {
            console.error("‚ùå Script Error:", e.message, e.filename, e.lineno, e.error);
        });

        // Log unhandled promise rejections
        window.addEventListener("unhandledrejection", (e) => {
            console.error("‚ùå Unhandled Promise Rejection:", e.reason);
        });
    </script>
</body>

</html>